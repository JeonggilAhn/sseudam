#!/bin/sh

# rebase ì‘ì—…ì¸ì§€ í™•ì¸
if [ "$1" = "rebase" ]; then

    # ìµœì‹  ì»¤ë°‹ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
    commit_msg=$(git log -1 --pretty=%B)
    new_commit_msg=$commit_msg

    # í˜„ì¬ ë¸Œëœì¹˜ ì´ë¦„
    branch_name=$(git rev-parse --abbrev-ref HEAD)

    # ë¸Œëœì¹˜ì—ì„œ Jira ì´ìŠˆ ë²ˆí˜¸ ì¶”ì¶œ
    issue_number=$(echo "$branch_name" | grep -oE 'S12P21A106-[0-9]+')

    # prefix ì°¾ê¸°
    prefix=$(echo "$commit_msg" | grep -oE "^(feat|fix|docs|style|refactor|test|chore|hotfix)")
    
    # ë©”ì‹œì§€ ì•ì— ì´ëª¨ì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
    if echo "$commit_msg" | grep -qE "^[[:space:]]*[[:punct:]]"; then
        has_emoji=true
    else
        has_emoji=false
    fi

    # ì´ëª¨ì§€ ë§¤í•‘
    case "$prefix" in
        "feat") emoji="âœ¨";;
        "fix") emoji="ğŸ›";;
        "docs") emoji="ğŸ“";;
        "style") emoji="ğŸ¨";;
        "refactor") emoji="â™»ï¸";;
        "test") emoji="â˜‘ï¸";;
        "chore") emoji="âš™ï¸";;
        "hotfix") emoji="ğŸ‘º";;
    esac
        
   # ì´ëª¨ì§€ê°€ ì—†ê³ , prefixê°€ ìœ íš¨í•œ ê²½ìš° ì´ëª¨ì§€ ì¶”ê°€
    if ! $has_emoji && [ -n "$emoji" ]; then
        new_commit_msg="$emoji $new_commit_msg"
    fi

    # ì»¤ë°‹ ë©”ì‹œì§€ì— ì´ìŠˆ ë²ˆí˜¸ê°€ ì—†ê³ , ë¸Œëœì¹˜ì—ì„œ ì´ìŠˆ ë²ˆí˜¸ê°€ ì¶”ì¶œëœ ê²½ìš° ì¶”ê°€
    if [ -n "$issue_number" ] && ! echo "$original_commit_msg" | grep -q "#$issue_number"; then
        new_commit_msg="$new_commit_msg #$issue_number"
    fi

    # ë³€ê²½ëœ ë©”ì‹œì§€ë¡œ ì»¤ë°‹ ìˆ˜ì •
    git commit --amend -m "$new_commit_msg"
fi 